<Page x:Class="ToxicBizBuddyWPF.Views.OrdersPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Orders">

    <!-- ===== Recursos locales sólo para esta página ===== -->
    <Page.Resources>
        <!-- Botón header azul -->
        <Style x:Key="HeaderPrimaryButton" TargetType="Button" BasedOn="{StaticResource BtnPrimary}">
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
        </Style>

        <!-- Botón ghost redondeado -->
        <Style x:Key="GhostRounded" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextStrongBrush}"/>
            <Setter Property="BorderBrush" Value="#E5E7F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderBrush" Value="#2563EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border CornerRadius="10"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1F56D6"/>
                                <Setter Property="BorderBrush" Value="#1F56D6"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#194AB9"/>
                                <Setter Property="BorderBrush" Value="#194AB9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Caja de búsqueda -->
        <Style x:Key="SearchFieldBorder" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E5E7F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10"/>
        </Style>

        <!-- Icon buttons -->
        <Style x:Key="ActionIconButton" TargetType="Button" BasedOn="{StaticResource IconButtonGhost}">
            <Setter Property="Width" Value="34"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border CornerRadius="8"
                                Background="White"
                                BorderBrush="#E5E7F0"
                                BorderThickness="1">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#2563EB"/>
                                <Setter Property="Foreground" Value="#2563EB"/>
                                <Setter Property="Background" Value="#EEF2FF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Pills de estado -->
        <Style x:Key="PillBase" TargetType="Border">
            <Setter Property="CornerRadius" Value="999"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        <Style x:Key="PillSuccess" TargetType="Border" BasedOn="{StaticResource PillBase}">
            <Setter Property="Background" Value="#E7F8EE"/>
            <Setter Property="BorderBrush" Value="#A7E4C3"/>
        </Style>
        <Style x:Key="PillWarning" TargetType="Border" BasedOn="{StaticResource PillBase}">
            <Setter Property="Background" Value="#FEF3C7"/>
            <Setter Property="BorderBrush" Value="#FACC15"/>
        </Style>
        <Style x:Key="PillDanger" TargetType="Border" BasedOn="{StaticResource PillBase}">
            <Setter Property="Background" Value="#FEE2E2"/>
            <Setter Property="BorderBrush" Value="#FCA5A5"/>
        </Style>

        <!-- Link del número de pedido -->
        <Style x:Key="OrderLink" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#2563EB"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">

            <!-- Header -->
            <Grid Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Gestión de Pedidos" Style="{StaticResource H1}"/>
                    <TextBlock Text="Administra todos los pedidos de tus clientes"
                               Style="{StaticResource Subtle}" Margin="0,4,0,0"/>
                </StackPanel>

                <Button Grid.Column="1" Style="{StaticResource HeaderPrimaryButton}" Click="NewOrder_Click">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="" FontFamily="Segoe MDL2 Assets" Margin="0,0,6,0"/>
                        <TextBlock Text="+ Nuevo Pedido"/>
                    </StackPanel>
                </Button>
            </Grid>

            <!-- Buscador + Filtros -->
            <Border CornerRadius="12" BorderBrush="#E5E7F0" BorderThickness="1" Background="#FBFBFE" Padding="8" Margin="0,0,0,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Border Style="{StaticResource SearchFieldBorder}" Margin="0,0,8,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1"
                                     Background="Transparent" BorderThickness="0" Padding="0"
                                     Style="{StaticResource InputText}"
                                     ToolTip="Buscar por cliente o número de pedido…"
                                     TextChanged="SearchBox_TextChanged"/>
                        </Grid>
                    </Border>

                    <Button Grid.Column="1" Style="{StaticResource GhostRounded}" Click="OpenFilters_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontFamily="Segoe MDL2 Assets" Margin="0,0,6,0"/>
                            <TextBlock Text="Filtros"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <!-- Lista -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Lista de Pedidos" Style="{StaticResource SectionTitle}" Margin="0,0,0,8"/>
                    <Separator Background="{StaticResource DividerBrush}" Height="1" Margin="0,8,0,8"/>

                    <DataGrid x:Name="OrdersGrid"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              HeadersVisibility="Column"
                              Padding="4"
                              ItemsSource="{Binding Orders}"
                              Style="{StaticResource DataGridBase}"
                              ColumnHeaderStyle="{StaticResource DataGridHeader}"
                              RowStyle="{StaticResource DataGridRowStyle}">
                        <DataGrid.Columns>

                            <!-- Pedido como link -->
                            <DataGridTemplateColumn Header="Pedido" Width="140">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Style="{StaticResource OrderLink}"
                                                   Text="{Binding Pedido}"
                                                   MouseLeftButtonUp="OrderLink_Click"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Cliente" Binding="{Binding Cliente}" Width="2*"/>
                            <DataGridTextColumn Header="Fecha"   Binding="{Binding Fecha}"   Width="160"/>
                            <DataGridTextColumn Header="Items"   Binding="{Binding Items}"   Width="120"/>
                            <DataGridTextColumn Header="Total"   Binding="{Binding Total}"   Width="140"/>

                            <!-- Estado -->
                            <DataGridTemplateColumn Header="Estado" Width="190">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ContentControl>
                                            <ContentControl.Style>
                                                <Style TargetType="ContentControl">
                                                    <Setter Property="Content">
                                                        <Setter.Value>
                                                            <Border Style="{StaticResource PillWarning}">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="" FontFamily="Segoe MDL2 Assets" Margin="0,0,6,0"/>
                                                                    <TextBlock Text="Pendiente" FontWeight="SemiBold"/>
                                                                </StackPanel>
                                                            </Border>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Estado}" Value="Completado">
                                                            <Setter Property="Content">
                                                                <Setter.Value>
                                                                    <Border Style="{StaticResource PillSuccess}">
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <TextBlock Text="" FontFamily="Segoe MDL2 Assets" Margin="0,0,6,0"/>
                                                                            <TextBlock Text="Completado" FontWeight="SemiBold"/>
                                                                        </StackPanel>
                                                                    </Border>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Estado}" Value="Cancelado">
                                                            <Setter Property="Content">
                                                                <Setter.Value>
                                                                    <Border Style="{StaticResource PillDanger}">
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <TextBlock Text="" FontFamily="Segoe MDL2 Assets" Margin="0,0,6,0"/>
                                                                            <TextBlock Text="Cancelado" FontWeight="SemiBold"/>
                                                                        </StackPanel>
                                                                    </Border>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ContentControl.Style>
                                        </ContentControl>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Acciones -->
                            <DataGridTemplateColumn Header="Acciones" Width="200">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Button Style="{StaticResource ActionIconButton}" ToolTip="Ver" Margin="0,0,6,0" Click="ViewOrder_Click">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets"/>
                                            </Button>
                                            <Button Style="{StaticResource ActionIconButton}" ToolTip="Editar" Margin="0,0,6,0" Click="EditOrder_Click">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets"/>
                                            </Button>
                                            <Button Style="{StaticResource ActionIconButton}" ToolTip="Duplicar" Margin="0,0,6,0" Click="DuplicateOrder_Click">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets"/>
                                            </Button>
                                            <Button Style="{StaticResource ActionIconButton}" ToolTip="Eliminar" Click="DeleteOrder_Click">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets"/>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</Page>

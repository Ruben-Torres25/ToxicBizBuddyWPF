<Page x:Class="ToxicBizBuddyWPF.Views.OrdersPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:components="clr-namespace:ToxicBizBuddyWPF.Components"
      Title="Gestión de Pedidos">

    <components:PageWrapper>
        <Grid Background="#F8FAFF">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Margin="24,20,24,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Gestión de Pedidos" Style="{StaticResource H1}"/>
                    <TextBlock Text="Administra todos los pedidos de tus clientes"
                     Style="{StaticResource Subtle}" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Botón igual al de ClientsPage -->
                <Button Grid.Column="1"
                Style="{StaticResource BtnPrimary}"
                Padding="10,6"
                Click="NewOrder_Click">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="" FontFamily="Segoe MDL2 Assets" Margin="0,0,6,0"/>
                        <TextBlock Text="+ Nuevo pedido"/>
                    </StackPanel>
                </Button>
            </Grid>

            <!-- Buscador + Filtros -->
            <Border Grid.Row="1" Margin="24,0,24,16" Padding="8"
              Background="White" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Border CornerRadius="8" BorderBrush="#E5E7EB" BorderThickness="1" Background="White" Padding="10" Margin="0,0,8,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Style="{StaticResource Orders.Icon}" Text="&#xE721;" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1" BorderThickness="0" Background="Transparent" Tag="Buscar por cliente o número de pedido…"/>
                        </Grid>
                    </Border>

                    <Button Grid.Column="1" Style="{StaticResource Orders.BtnGhost}" Click="OpenFilters_Click">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Style="{StaticResource Orders.Icon}" Text="&#xE16E;" Margin="0,0,8,0"/>
                            <TextBlock Text="Filtros" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <!-- Lista de pedidos -->
            <Border Grid.Row="2" Margin="24" Style="{StaticResource Orders.CardStyle}">
                <StackPanel>
                    <TextBlock Text="Lista de Pedidos" Style="{StaticResource SectionTitle}" Margin="0,0,0,8"/>
                    <Separator Background="{StaticResource Orders.DividerBrush}" Height="1" Margin="0,8,0,8"/>

                    <DataGrid Tag="OrdersGridRef"
                    IsReadOnly="True"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    HeadersVisibility="Column"
                    GridLinesVisibility="None"
                    RowStyle="{StaticResource Orders.FlatDataGridRow}"
                    CellStyle="{StaticResource Orders.FlatDataGridCell}"
                    Style="{StaticResource Orders.DataGridBase}"
                    ColumnHeaderStyle="{StaticResource Orders.FlatDataGridHeader}"
                    SelectionChanged="OrdersGrid_SelectionChanged"
                    ColumnWidth="*"
                    HorizontalScrollBarVisibility="Auto"
                    CanUserResizeColumns="False">

                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Pedido" Width="*" MinWidth="100" HeaderStyle="{StaticResource Orders.LeftHeader}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Pedido}"
                               Style="{StaticResource Orders.OrderLink}"
                               FontSize="14"
                               TextAlignment="Left"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"
                               MouseLeftButtonDown="OpenOrderLink_Click"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Cliente" Width="*" MinWidth="140" HeaderStyle="{StaticResource Orders.LeftHeader}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Cliente}" FontSize="14"
                               TextAlignment="Left" VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Fecha" Width="*" MinWidth="110" HeaderStyle="{StaticResource Orders.CenterHeader}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Fecha}" FontSize="14"
                               Foreground="#64748B" TextAlignment="Center"
                               VerticalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Items" Width="*" MinWidth="90" HeaderStyle="{StaticResource Orders.CenterHeader}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Items}" FontSize="14"
                               TextAlignment="Center" VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Estado" Width="*" MinWidth="120" HeaderStyle="{StaticResource Orders.CenterHeader}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource Orders.BadgeCompletedUltra}" VerticalAlignment="Center" Margin="0,0,8,0">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <TextBlock Style="{StaticResource Orders.BadgeIcon}" FontSize="14" Text="&#xE73E;"/>
                                                <TextBlock Style="{StaticResource Orders.BadgeText}" FontSize="14" Text="{Binding Estado}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Total" Width="*" MinWidth="130" HeaderStyle="{StaticResource Orders.CenterHeader}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Total}" FontWeight="SemiBold" FontSize="14"
                               TextAlignment="Center" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Acciones" Width="*" MinWidth="200" HeaderStyle="{StaticResource Orders.CenterHeader}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource Orders.IconButtonGhostSm}" ToolTip="Ver" Click="ViewOrder_Click">
                                                <TextBlock Style="{StaticResource Orders.Icon}" Text="&#xE8F4;" FontSize="14"/>
                                            </Button>
                                            <Button Style="{StaticResource Orders.IconButtonGhostSm}" ToolTip="Editar" Click="EditOrder_Click">
                                                <TextBlock Style="{StaticResource Orders.Icon}" Text="&#xE70F;" FontSize="14"/>
                                            </Button>
                                            <Button Style="{StaticResource Orders.IconButtonGhostSm}" ToolTip="Duplicar" Click="DuplicateOrder_Click">
                                                <TextBlock Style="{StaticResource Orders.Icon}" Text="&#xE8C8;" FontSize="14"/>
                                            </Button>
                                            <Button Style="{StaticResource Orders.IconButtonGhostSm}" ToolTip="Eliminar" Click="DeleteOrder_Click" Margin="0">
                                                <TextBlock Style="{StaticResource Orders.Icon}" Text="&#xE74D;" FontSize="14"/>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>

            <!-- Paginación -->
            <StackPanel Grid.Row="3" Margin="24,0,24,16" HorizontalAlignment="Right">
                <components:Pagination/>
            </StackPanel>
        </Grid>
    </components:PageWrapper>
</Page>
